# Copilot Instructions for kennethheine.com

This project is a modern Infrastructure as Code (IaC) implementation for deploying Azure Static Web Apps using Bicep templates and GitHub Actions.

## üìã Project Overview

**Project Type:** Azure Static Web App with Infrastructure as Code
**Tech Stack:** Bicep, GitHub Actions, HTML/CSS/JavaScript, PowerShell
**Deployment:** Azure Static Web Apps with federated identity authentication
**Author:** Kenneth S√∏lberg

## üèóÔ∏è Architecture & Structure

### Core Components
- **`infra/`** - Bicep Infrastructure as Code templates
- **`static-web-app/`** - Frontend application source code
- **`.github/workflows/`** - CI/CD pipeline definitions
- **`scripts/`** - PowerShell automation scripts for Azure setup

### Key Technologies
- **Azure Static Web Apps** - Primary hosting platform
- **Bicep** - Infrastructure as Code language
- **GitHub Actions** - CI/CD automation
- **OIDC/Federated Identity** - Secure authentication without secrets
- **PowerShell** - Azure configuration automation

## üéØ Code Generation Guidelines

### Infrastructure (Bicep)
- Always use the latest API versions (check Azure documentation)
- Follow the existing naming convention: `{resourceType}-{projectName}-{environment}`
- Use resource tokens for unique naming: `uniqueString(subscription().subscriptionId, resourceGroup().id)`
- Include comprehensive parameter descriptions with `@description()` decorators
- Apply consistent tagging strategy with project, environment, and managedBy tags
- Use modular approach - create reusable modules in `infra/modules/`
- Enable Bicep analyzer rules for security and best practices

### GitHub Actions Workflows
- Use federated identity (OIDC) for Azure authentication - never store secrets
- Include comprehensive what-if analysis before deployments
- Add detailed logging with emojis for better readability (üîç, ‚úÖ, ‚ùå, üöÄ, etc.)
- Implement proper error handling and validation steps
- Create detailed GitHub step summaries with status information
- Use environment protection for production deployments

### PowerShell Scripts
- Follow PowerShell best practices with proper error handling
- Use meaningful variable names and comments
- Include verbose output for troubleshooting
- Implement retry logic for transient Azure failures
- Use approved PowerShell verbs (Get-, Set-, New-, Remove-)

### Frontend Development
- Keep it simple and modern - this is a personal website
- Use semantic HTML5 structure
- Implement responsive CSS design
- Follow accessibility best practices
- Minimize dependencies - prefer vanilla JavaScript when possible

## üîß Development Practices

### File Naming & Organization
- Use kebab-case for file names
- Organize Bicep templates in logical modules
- Keep parameters in separate `.bicepparam` files
- Use descriptive names that indicate purpose

### Security Best Practices
- Never expose secrets in Bicep outputs
- Use managed identities where possible
- Implement least-privilege access
- Enable diagnostic settings for monitoring
- Use secure parameter types (`@secure()`) for sensitive data

### Testing & Validation
- Always run Bicep what-if analysis before deployment
- Validate templates using `az deployment group validate`
- Test workflows in feature branches before merging
- Include comprehensive error handling

## üö® Important Rules

### Never Do
- ‚ùå Store secrets in GitHub repository or workflows
- ‚ùå Use hardcoded values - always parameterize
- ‚ùå Skip what-if analysis for infrastructure changes
- ‚ùå Deploy directly to production without validation
- ‚ùå Remove security and monitoring configurations

### Always Do
- ‚úÖ Use federated identity for Azure authentication
- ‚úÖ Include comprehensive logging and status reporting
- ‚úÖ Follow Infrastructure as Code principles
- ‚úÖ Test changes in feature branches first
- ‚úÖ Document infrastructure decisions and configurations
- ‚úÖ Use consistent naming conventions
- ‚úÖ Implement proper error handling

## üîÑ Workflow Patterns

### Infrastructure Changes
1. Create feature branch
2. Modify Bicep templates or parameters
3. Push changes to trigger what-if analysis
4. Review what-if output in PR
5. Merge to main for automatic deployment

### Frontend Updates
1. Modify files in `static-web-app/src/`
2. Test locally using SWA CLI: `npm start`
3. Push to feature branch for preview deployment (PR)
4. Review preview environment
5. Merge to main for production deployment

### Frontend Deployment Workflow
- **Validation Job**: Validates code structure, dependencies, and configuration
- **Preview Job**: Creates preview environment for PRs with automatic cleanup
- **Deploy Job**: Deploys to production on main branch merge
- **Token Management**: Securely retrieves deployment tokens using OIDC
- **Verification**: Confirms deployment success and provides access URLs

## üí° Common Tasks

### Adding New Azure Resources
1. Create or update Bicep module in `infra/modules/`
2. Reference module in `main.bicep`
3. Add parameters to `production.bicepparam`
4. Test with what-if analysis

### Updating Frontend Content
1. Modify files in `static-web-app/src/` (HTML, CSS, JS, assets)
2. Test locally using SWA CLI: `npm start`
3. Push changes to trigger validation and deployment
4. Review deployment summary and verify live site

### Updating Deployment Configuration
1. Modify workflow files in `.github/workflows/`
2. Test in feature branch
3. Review execution logs carefully

### Environment Configuration
- Production parameters: `infra/parameters/production.bicepparam`
- GitHub secrets configured via PowerShell scripts in `scripts/`
- Resource naming follows: `{type}-kennethheine-{env}` pattern

## üé® Style Preferences

- Use emojis in logging for better visual scanning
- Prefer descriptive variable names over abbreviations
- Include comprehensive comments for complex logic
- Use consistent indentation (2 spaces for YAML, 4 for PowerShell)
- Group related configurations together

## üîç Debugging & Troubleshooting

- Check GitHub Actions logs for deployment issues
- Use Azure CLI what-if for infrastructure validation
- Review Bicep analyzer warnings and errors
- Verify OIDC configuration if authentication fails
- Check resource group permissions for deployment failures

Remember: This is a production website deployment system. Prioritize security, reliability, and maintainability in all code generation and modifications.
